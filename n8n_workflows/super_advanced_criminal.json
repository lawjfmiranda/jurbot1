{
  "name": "‚öñÔ∏è SUPER CRIMINAL - Dr. JM Especialista Completo",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "super_criminal",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "webhook-super-criminal",
      "name": "‚öñÔ∏è Webhook Criminal Avan√ßado",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [240, 400]
    },
    {
      "parameters": {
        "jsCode": "// ‚öñÔ∏è SUPER PROCESSADOR CRIMINAL - Dr. JM Miranda\nconst inputData = $input.all()[0].json;\n\nconst userNumber = inputData.user_number;\nconst message = inputData.message.toLowerCase();\nconst clientInfo = inputData.client_info || {};\nconst timestamp = new Date();\n\nconsole.log('‚öñÔ∏è SUPER CRIMINAL processando:', userNumber);\n\n// ========================\n// üö® CLASSIFICA√á√ÉO ULTRA-ESPEC√çFICA\n// ========================\n\nlet caseType = 'geral';\nlet urgencyLevel = 1; // 1-5 (5 = m√°xima urg√™ncia)\nlet drJMSpecialty = false;\nlet immediateAction = [];\nlet documentsNeeded = [];\nlet legalStrategy = [];\nlet estimatedCost = 'consulta';\nlet timeframe = '30 dias';\n\n// üö® FLAGRANTE - URG√äNCIA M√ÅXIMA\nif (message.includes('preso') || message.includes('flagrante') || message.includes('cust√≥dia')) {\n  caseType = 'flagrante';\n  urgencyLevel = 5;\n  drJMSpecialty = true;\n  timeframe = '24 horas';\n  estimatedCost = 'R$ 3.000 - R$ 8.000';\n  \n  immediateAction = [\n    'Contato imediato com delegacia',\n    'Habeas Corpus preventivo',\n    'Acompanhamento audi√™ncia cust√≥dia',\n    'Pedido liberdade provis√≥ria',\n    'Orienta√ß√£o familiar'\n  ];\n  \n  documentsNeeded = [\n    'RG e CPF do preso',\n    'Comprovante resid√™ncia',\n    'Comprovante renda',\n    'Certid√£o antecedentes',\n    'Contato de testemunhas'\n  ];\n  \n  legalStrategy = [\n    'Questionar legalidade da pris√£o',\n    'Verificar v√≠cios no flagrante',\n    'Pedido de relaxamento',\n    'Medidas cautelares alternativas',\n    'Defesa t√©cnica especializada'\n  ];\n}\n\n// üîç INQU√âRITO POLICIAL - ALTA PRIORIDADE\nelse if (message.includes('inqu√©rito') || message.includes('delegacia') || message.includes('investiga√ß√£o')) {\n  caseType = 'inquerito';\n  urgencyLevel = 4;\n  drJMSpecialty = true;\n  timeframe = '7 dias';\n  estimatedCost = 'R$ 2.000 - R$ 5.000';\n  \n  immediateAction = [\n    'An√°lise do inqu√©rito',\n    'Acompanhamento em depoimentos',\n    'Juntada de documentos',\n    'Pedidos de dilig√™ncias',\n    'Defesa pr√©via especializada'\n  ];\n  \n  documentsNeeded = [\n    'Intima√ß√£o recebida',\n    'C√≥pia do inqu√©rito (se tiver)',\n    'Documentos pessoais',\n    'Comprovantes de √°libi',\n    'Contatos de testemunhas'\n  ];\n  \n  legalStrategy = [\n    'Controle da investiga√ß√£o',\n    'Produ√ß√£o de provas favor√°veis',\n    'Questionamento de ilegalidades',\n    'Pedido de arquivamento',\n    'Prepara√ß√£o para eventual den√∫ncia'\n  ];\n}\n\n// üìã PROCESSO CRIMINAL - DEFESA T√âCNICA\nelse if (message.includes('processo') || message.includes('den√∫ncia') || message.includes('audi√™ncia')) {\n  caseType = 'processo';\n  urgencyLevel = 3;\n  drJMSpecialty = true;\n  timeframe = '15 dias';\n  estimatedCost = 'R$ 4.000 - R$ 15.000';\n  \n  immediateAction = [\n    'An√°lise da den√∫ncia',\n    'Resposta √† acusa√ß√£o',\n    'Rol de testemunhas',\n    'Estrat√©gia de defesa',\n    'Prepara√ß√£o para audi√™ncias'\n  ];\n  \n  legalStrategy = [\n    'Contesta√ß√£o da materialidade',\n    'Questionamento da autoria',\n    'Excludentes de ilicitude',\n    'Teses absolut√≥rias',\n    'Dosimetria da pena'\n  ];\n}\n\n// üìú RECURSOS - ESPECIALIDADE DR. JM\nelse if (message.includes('recurso') || message.includes('apela√ß√£o') || message.includes('condenado')) {\n  caseType = 'recurso';\n  urgencyLevel = 4;\n  drJMSpecialty = true;\n  timeframe = '5 dias'; // Prazo recursal\n  estimatedCost = 'R$ 3.000 - R$ 10.000';\n  \n  immediateAction = [\n    'An√°lise da senten√ßa',\n    'Identifica√ß√£o de v√≠cios',\n    'Elabora√ß√£o de recurso',\n    'Pedido de efeito suspensivo',\n    'Sustenta√ß√£o oral'\n  ];\n  \n  legalStrategy = [\n    'Nulidades processuais',\n    'Erro de fato ou direito',\n    'Reforma da senten√ßa',\n    'Redu√ß√£o da pena',\n    'Substitui√ß√£o por restritiva'\n  ];\n}\n\n// üåø DROGAS - ESTRAT√âGIA ESPEC√çFICA\nelse if (message.includes('droga') || message.includes('tr√°fico') || message.includes('entorpecente')) {\n  caseType = 'drogas';\n  urgencyLevel = 3;\n  drJMSpecialty = true;\n  estimatedCost = 'R$ 5.000 - R$ 20.000';\n  \n  legalStrategy = [\n    'Desclassifica√ß√£o tr√°fico para uso',\n    'Questionamento da apreens√£o',\n    'V√≠cios na cadeia de cust√≥dia',\n    'Princ√≠pio da insignific√¢ncia',\n    'Medidas alternativas'\n  ];\n}\n\n// ========================\n// üéì CREDENCIAIS DR. JM\n// ========================\n\nconst drJMCredentials = [\n  'üë®‚Äçüè´ Professor de Direito Penal',\n  'üéì Professor de Processo Penal',\n  'üìö Coordenador Curso de Direito FAM',\n  'üîç P√≥s-graduado em Investiga√ß√£o Criminal',\n  'üß† Especialista em Psicologia Forense',\n  '‚öñÔ∏è Focado em Direito Restitutivo'\n];\n\n// ========================\n// üìä AN√ÅLISE DE VIABILIDADE\n// ========================\n\nfunction calculateViability(caseType, urgency) {\n  let viability = 'alta';\n  let successChance = '80%';\n  \n  switch(caseType) {\n    case 'flagrante':\n      viability = 'muito alta';\n      successChance = '90%';\n      break;\n    case 'inquerito':\n      viability = 'alta';\n      successChance = '85%';\n      break;\n    case 'recurso':\n      viability = 'alta';\n      successChance = '75%';\n      break;\n    case 'drogas':\n      viability = 'm√©dia-alta';\n      successChance = '70%';\n      break;\n  }\n  \n  return { viability, successChance };\n}\n\nconst analysis = calculateViability(caseType, urgencyLevel);\n\n// ========================\n// üî• RESPOSTA ULTRA-PERSONALIZADA\n// ========================\n\nfunction generateResponse(caseType, urgency, analysis) {\n  const urgencyEmoji = urgency >= 4 ? 'üö®' : urgency >= 3 ? '‚ö†Ô∏è' : '‚öñÔ∏è';\n  const drCredits = drJMCredentials.slice(0, 3).join('\\n‚Ä¢ ');\n  \n  let response = `${urgencyEmoji} CASO CRIMINAL - Dr. JM Miranda\\n\\n`;\n  \n  // Credenciais do Dr. JM\n  response += `üë®‚Äç‚öñÔ∏è SEU ADVOGADO:\\n‚Ä¢ ${drCredits}\\n\\n`;\n  \n  // An√°lise do caso\n  response += `üìä AN√ÅLISE DO SEU CASO:\\n`;\n  response += `‚Ä¢ Tipo: ${caseType.toUpperCase()}\\n`;\n  response += `‚Ä¢ Urg√™ncia: ${urgency}/5 ${urgency >= 4 ? '(ALTA)' : '(NORMAL)'}\\n`;\n  response += `‚Ä¢ Viabilidade: ${analysis.viability}\\n`;\n  response += `‚Ä¢ Chance sucesso: ${analysis.successChance}\\n`;\n  response += `‚Ä¢ Prazo a√ß√£o: ${timeframe}\\n\\n`;\n  \n  // A√ß√µes imediatas\n  if (immediateAction.length > 0) {\n    response += `‚ö° A√á√ïES IMEDIATAS:\\n`;\n    response += immediateAction.map((action, i) => `${i+1}. ${action}`).join('\\n') + '\\n\\n';\n  }\n  \n  // Estrat√©gia jur√≠dica\n  if (legalStrategy.length > 0) {\n    response += `üéØ ESTRAT√âGIA JUR√çDICA:\\n`;\n    response += legalStrategy.map((strategy, i) => `‚Ä¢ ${strategy}`).join('\\n') + '\\n\\n';\n  }\n  \n  // Documentos necess√°rios\n  if (documentsNeeded.length > 0) {\n    response += `üìã DOCUMENTOS NECESS√ÅRIOS:\\n`;\n    response += documentsNeeded.map((doc, i) => `${i+1}. ${doc}`).join('\\n') + '\\n\\n';\n  }\n  \n  // Investimento\n  response += `üí∞ INVESTIMENTO: ${estimatedCost}\\n\\n`;\n  \n  // Call to action\n  if (urgency >= 4) {\n    response += `üî¥ URGENTE: Dr. JM precisa falar com voc√™ HOJE!\\n`;\n    response += `üìû Vou agendar contato IMEDIATO!`;\n  } else {\n    response += `üìû Vamos agendar sua consulta estrat√©gica com Dr. JM?`;\n  }\n  \n  return response;\n}\n\nconst response = generateResponse(caseType, urgencyLevel, analysis);\n\n// ========================\n// üéØ RESULTADO FINAL\n// ========================\n\nconst result = {\n  user_number: userNumber,\n  case_type: 'criminal',\n  subtype: caseType,\n  urgency_level: urgencyLevel,\n  dr_jm_specialty: drJMSpecialty,\n  \n  // An√°lise detalhada\n  viability: analysis.viability,\n  success_chance: analysis.successChance,\n  estimated_cost: estimatedCost,\n  timeframe: timeframe,\n  \n  // A√ß√µes e estrat√©gias\n  immediate_actions: immediateAction,\n  legal_strategy: legalStrategy,\n  documents_needed: documentsNeeded,\n  \n  // Resposta e pr√≥ximos passos\n  response: response,\n  needs_immediate_contact: urgencyLevel >= 4,\n  needs_scheduling: urgencyLevel < 4,\n  priority_level: urgencyLevel >= 4 ? 'urgent' : 'high',\n  \n  // M√©tricas\n  processed_at: timestamp.toISOString(),\n  processing_time: 'instantaneous',\n  dr_jm_credentials: drJMCredentials,\n  \n  // Pr√≥ximas a√ß√µes\n  next_steps: [\n    urgencyLevel >= 4 ? 'Contato imediato Dr. JM' : 'Agendar consulta',\n    'Reunir documentos necess√°rios',\n    'Preparar estrat√©gia de defesa',\n    'Iniciar procedimentos legais'\n  ]\n};\n\nconsole.log('‚öñÔ∏è SUPER CRIMINAL processado:', result);\n\nreturn result;"
      },
      "id": "super-criminal-processor",
      "name": "‚öñÔ∏è Super Processador Criminal",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [440, 400]
    },
    {
      "parameters": {
        "conditions": {
          "number": [
            {
              "value1": "={{ $json.urgency_level }}",
              "operation": "largerEqual",
              "value2": 4
            }
          ]
        }
      },
      "id": "check-urgent-criminal",
      "name": "üö® Caso Urgente?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [640, 400]
    },
    {
      "parameters": {
        "to": "dr.jm@jmadvogados.com.br",
        "subject": "üö® CASO CRIMINAL URGENTE - {{ $json.subtype.toUpperCase() }}",
        "message": "ALERTA URG√äNCIA M√ÅXIMA\\n\\nüë§ Cliente: {{ $json.user_number }}\\n‚öñÔ∏è Tipo: {{ $json.subtype }}\\nüö® Urg√™ncia: {{ $json.urgency_level }}/5\\n‚è∞ Prazo: {{ $json.timeframe }}\\n\\nüì± MENSAGEM:\\n{{ $json.message }}\\n\\nüéØ A√á√ïES IMEDIATAS:\\n{{ $json.immediate_actions.join('\\n‚Ä¢ ') }}\\n\\nüìû CONTATO NECESS√ÅRIO: HOJE!"
      },
      "id": "email-urgent-alert",
      "name": "üìß Email Urgente Dr. JM",
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2,
      "position": [840, 300]
    },
    {
      "parameters": {
        "url": "https://api.whatsapp.com/send",
        "method": "POST",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "phone",
              "value": "+5544999999999"
            },
            {
              "name": "message",
              "value": "üö® CASO URGENTE\\n\\nCliente: {{ $json.user_number }}\\nTipo: {{ $json.subtype }}\\nUrg√™ncia: {{ $json.urgency_level }}/5\\n\\nPrecisa contato IMEDIATO!"
            }
          ]
        }
      },
      "id": "whatsapp-alert-drjm",
      "name": "üì± WhatsApp Dr. JM",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [840, 200]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "INSERT INTO criminal_cases (user_number, case_type, subtype, urgency_level, viability, estimated_cost, immediate_actions, legal_strategy, documents_needed, created_at, dr_jm_specialty) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)",
        "parameters": {
          "parameters": [
            {
              "name": "user_number",
              "value": "={{ $json.user_number }}"
            },
            {
              "name": "case_type",
              "value": "criminal"
            },
            {
              "name": "subtype",
              "value": "={{ $json.subtype }}"
            },
            {
              "name": "urgency_level",
              "value": "={{ $json.urgency_level }}"
            },
            {
              "name": "viability",
              "value": "={{ $json.viability }}"
            },
            {
              "name": "estimated_cost",
              "value": "={{ $json.estimated_cost }}"
            },
            {
              "name": "immediate_actions",
              "value": "={{ JSON.stringify($json.immediate_actions) }}"
            },
            {
              "name": "legal_strategy",
              "value": "={{ JSON.stringify($json.legal_strategy) }}"
            },
            {
              "name": "documents_needed",
              "value": "={{ JSON.stringify($json.documents_needed) }}"
            },
            {
              "name": "created_at",
              "value": "={{ $json.processed_at }}"
            },
            {
              "name": "dr_jm_specialty",
              "value": "={{ $json.dr_jm_specialty }}"
            }
          ]
        }
      },
      "id": "save-criminal-case",
      "name": "üíæ Salvar Caso Criminal",
      "type": "n8n-nodes-base.sqlite",
      "typeVersion": 1,
      "position": [1040, 400]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{ $json.needs_scheduling }}",
              "value2": true
            }
          ]
        }
      },
      "id": "check-needs-schedule",
      "name": "üìÖ Precisa Agendar?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [1240, 400]
    },
    {
      "parameters": {
        "url": "https://n8n-n8n.c9ewnj.easypanel.host/webhook/master_bot",
        "method": "POST",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "user_number",
              "value": "={{ $json.user_number }}"
            },
            {
              "name": "message",
              "value": "agendar consulta criminal"
            },
            {
              "name": "current_state",
              "value": "FREE"
            },
            {
              "name": "case_context",
              "value": "={{ $json.subtype }}"
            }
          ]
        }
      },
      "id": "trigger-scheduling",
      "name": "üìÖ Disparar Agendamento",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [1440, 300]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ { \"response\": $json.response, \"urgency\": $json.urgency_level, \"needs_immediate_contact\": $json.needs_immediate_contact, \"case_analysis\": { \"viability\": $json.viability, \"success_chance\": $json.success_chance, \"estimated_cost\": $json.estimated_cost }, \"next_steps\": $json.next_steps } }}"
      },
      "id": "final-criminal-response",
      "name": "‚öñÔ∏è Resposta Criminal Final",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [1640, 400]
    }
  ],
  "connections": {
    "‚öñÔ∏è Webhook Criminal Avan√ßado": {
      "main": [
        [
          {
            "node": "‚öñÔ∏è Super Processador Criminal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "‚öñÔ∏è Super Processador Criminal": {
      "main": [
        [
          {
            "node": "üö® Caso Urgente?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üö® Caso Urgente?": {
      "main": [
        [
          {
            "node": "üì± WhatsApp Dr. JM",
            "type": "main",
            "index": 0
          },
          {
            "node": "üìß Email Urgente Dr. JM",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "üíæ Salvar Caso Criminal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üìß Email Urgente Dr. JM": {
      "main": [
        [
          {
            "node": "üíæ Salvar Caso Criminal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üì± WhatsApp Dr. JM": {
      "main": [
        [
          {
            "node": "üíæ Salvar Caso Criminal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üíæ Salvar Caso Criminal": {
      "main": [
        [
          {
            "node": "üìÖ Precisa Agendar?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üìÖ Precisa Agendar?": {
      "main": [
        [
          {
            "node": "üìÖ Disparar Agendamento",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "‚öñÔ∏è Resposta Criminal Final",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üìÖ Disparar Agendamento": {
      "main": [
        [
          {
            "node": "‚öñÔ∏è Resposta Criminal Final",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {},
  "versionId": "1"
}
