{
  "name": "âš–ï¸ SUPER CRIMINAL - Dr. JM Especialista Completo",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "super_criminal",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "webhook-super-criminal",
      "name": "âš–ï¸ Webhook Criminal AvanÃ§ado",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [240, 400]
    },
    {
      "parameters": {
        "jsCode": "// âš–ï¸ SUPER PROCESSADOR CRIMINAL - Dr. JM Miranda\nconst inputData = $input.all()[0].json;\n\nconst userNumber = inputData.user_number;\nconst message = inputData.message.toLowerCase();\nconst clientInfo = inputData.client_info || {};\nconst timestamp = new Date();\n\nconsole.log('âš–ï¸ SUPER CRIMINAL processando:', userNumber);\n\n// ========================\n// ğŸš¨ CLASSIFICAÃ‡ÃƒO ULTRA-ESPECÃFICA\n// ========================\n\nlet caseType = 'geral';\nlet urgencyLevel = 1; // 1-5 (5 = mÃ¡xima urgÃªncia)\nlet drJMSpecialty = false;\nlet immediateAction = [];\nlet documentsNeeded = [];\nlet legalStrategy = [];\nlet estimatedCost = 'consulta';\nlet timeframe = '30 dias';\n\n// ğŸš¨ FLAGRANTE - URGÃŠNCIA MÃXIMA\nif (message.includes('preso') || message.includes('flagrante') || message.includes('custÃ³dia')) {\n  caseType = 'flagrante';\n  urgencyLevel = 5;\n  drJMSpecialty = true;\n  timeframe = '24 horas';\n  estimatedCost = 'R$ 3.000 - R$ 8.000';\n  \n  immediateAction = [\n    'Contato imediato com delegacia',\n    'Habeas Corpus preventivo',\n    'Acompanhamento audiÃªncia custÃ³dia',\n    'Pedido liberdade provisÃ³ria',\n    'OrientaÃ§Ã£o familiar'\n  ];\n  \n  documentsNeeded = [\n    'RG e CPF do preso',\n    'Comprovante residÃªncia',\n    'Comprovante renda',\n    'CertidÃ£o antecedentes',\n    'Contato de testemunhas'\n  ];\n  \n  legalStrategy = [\n    'Questionar legalidade da prisÃ£o',\n    'Verificar vÃ­cios no flagrante',\n    'Pedido de relaxamento',\n    'Medidas cautelares alternativas',\n    'Defesa tÃ©cnica especializada'\n  ];\n}\n\n// ğŸ” INQUÃ‰RITO POLICIAL - ALTA PRIORIDADE\nelse if (message.includes('inquÃ©rito') || message.includes('delegacia') || message.includes('investigaÃ§Ã£o')) {\n  caseType = 'inquerito';\n  urgencyLevel = 4;\n  drJMSpecialty = true;\n  timeframe = '7 dias';\n  estimatedCost = 'R$ 2.000 - R$ 5.000';\n  \n  immediateAction = [\n    'AnÃ¡lise do inquÃ©rito',\n    'Acompanhamento em depoimentos',\n    'Juntada de documentos',\n    'Pedidos de diligÃªncias',\n    'Defesa prÃ©via especializada'\n  ];\n  \n  documentsNeeded = [\n    'IntimaÃ§Ã£o recebida',\n    'CÃ³pia do inquÃ©rito (se tiver)',\n    'Documentos pessoais',\n    'Comprovantes de Ã¡libi',\n    'Contatos de testemunhas'\n  ];\n  \n  legalStrategy = [\n    'Controle da investigaÃ§Ã£o',\n    'ProduÃ§Ã£o de provas favorÃ¡veis',\n    'Questionamento de ilegalidades',\n    'Pedido de arquivamento',\n    'PreparaÃ§Ã£o para eventual denÃºncia'\n  ];\n}\n\n// ğŸ“‹ PROCESSO CRIMINAL - DEFESA TÃ‰CNICA\nelse if (message.includes('processo') || message.includes('denÃºncia') || message.includes('audiÃªncia')) {\n  caseType = 'processo';\n  urgencyLevel = 3;\n  drJMSpecialty = true;\n  timeframe = '15 dias';\n  estimatedCost = 'R$ 4.000 - R$ 15.000';\n  \n  immediateAction = [\n    'AnÃ¡lise da denÃºncia',\n    'Resposta Ã  acusaÃ§Ã£o',\n    'Rol de testemunhas',\n    'EstratÃ©gia de defesa',\n    'PreparaÃ§Ã£o para audiÃªncias'\n  ];\n  \n  legalStrategy = [\n    'ContestaÃ§Ã£o da materialidade',\n    'Questionamento da autoria',\n    'Excludentes de ilicitude',\n    'Teses absolutÃ³rias',\n    'Dosimetria da pena'\n  ];\n}\n\n// ğŸ“œ RECURSOS - ESPECIALIDADE DR. JM\nelse if (message.includes('recurso') || message.includes('apelaÃ§Ã£o') || message.includes('condenado')) {\n  caseType = 'recurso';\n  urgencyLevel = 4;\n  drJMSpecialty = true;\n  timeframe = '5 dias'; // Prazo recursal\n  estimatedCost = 'R$ 3.000 - R$ 10.000';\n  \n  immediateAction = [\n    'AnÃ¡lise da sentenÃ§a',\n    'IdentificaÃ§Ã£o de vÃ­cios',\n    'ElaboraÃ§Ã£o de recurso',\n    'Pedido de efeito suspensivo',\n    'SustentaÃ§Ã£o oral'\n  ];\n  \n  legalStrategy = [\n    'Nulidades processuais',\n    'Erro de fato ou direito',\n    'Reforma da sentenÃ§a',\n    'ReduÃ§Ã£o da pena',\n    'SubstituiÃ§Ã£o por restritiva'\n  ];\n}\n\n// ğŸŒ¿ DROGAS - ESTRATÃ‰GIA ESPECÃFICA\nelse if (message.includes('droga') || message.includes('trÃ¡fico') || message.includes('entorpecente')) {\n  caseType = 'drogas';\n  urgencyLevel = 3;\n  drJMSpecialty = true;\n  estimatedCost = 'R$ 5.000 - R$ 20.000';\n  \n  legalStrategy = [\n    'DesclassificaÃ§Ã£o trÃ¡fico para uso',\n    'Questionamento da apreensÃ£o',\n    'VÃ­cios na cadeia de custÃ³dia',\n    'PrincÃ­pio da insignificÃ¢ncia',\n    'Medidas alternativas'\n  ];\n}\n\n// ========================\n// ğŸ“ CREDENCIAIS DR. JM\n// ========================\n\nconst drJMCredentials = [\n  'ğŸ‘¨â€ğŸ« Professor de Direito Penal',\n  'ğŸ“ Professor de Processo Penal',\n  'ğŸ“š Coordenador Curso de Direito FAM',\n  'ğŸ” PÃ³s-graduado em InvestigaÃ§Ã£o Criminal',\n  'ğŸ§  Especialista em Psicologia Forense',\n  'âš–ï¸ Focado em Direito Restitutivo'\n];\n\n// ========================\n// ğŸ“Š ANÃLISE DE VIABILIDADE\n// ========================\n\nfunction calculateViability(caseType, urgency) {\n  let viability = 'alta';\n  let successChance = '80%';\n  \n  switch(caseType) {\n    case 'flagrante':\n      viability = 'muito alta';\n      successChance = '90%';\n      break;\n    case 'inquerito':\n      viability = 'alta';\n      successChance = '85%';\n      break;\n    case 'recurso':\n      viability = 'alta';\n      successChance = '75%';\n      break;\n    case 'drogas':\n      viability = 'mÃ©dia-alta';\n      successChance = '70%';\n      break;\n  }\n  \n  return { viability, successChance };\n}\n\nconst analysis = calculateViability(caseType, urgencyLevel);\n\n// ========================\n// ğŸ”¥ RESPOSTA ULTRA-PERSONALIZADA\n// ========================\n\nfunction generateResponse(caseType, urgency, analysis) {\n  const urgencyEmoji = urgency >= 4 ? 'ğŸš¨' : urgency >= 3 ? 'âš ï¸' : 'âš–ï¸';\n  const drCredits = drJMCredentials.slice(0, 3).join('\\nâ€¢ ');\n  \n  let response = `${urgencyEmoji} CASO CRIMINAL - Dr. JM Miranda\\n\\n`;\n  \n  // Credenciais do Dr. JM\n  response += `ğŸ‘¨â€âš–ï¸ SEU ADVOGADO:\\nâ€¢ ${drCredits}\\n\\n`;\n  \n  // AnÃ¡lise do caso\n  response += `ğŸ“Š ANÃLISE DO SEU CASO:\\n`;\n  response += `â€¢ Tipo: ${caseType.toUpperCase()}\\n`;\n  response += `â€¢ UrgÃªncia: ${urgency}/5 ${urgency >= 4 ? '(ALTA)' : '(NORMAL)'}\\n`;\n  response += `â€¢ Viabilidade: ${analysis.viability}\\n`;\n  response += `â€¢ Chance sucesso: ${analysis.successChance}\\n`;\n  response += `â€¢ Prazo aÃ§Ã£o: ${timeframe}\\n\\n`;\n  \n  // AÃ§Ãµes imediatas\n  if (immediateAction.length > 0) {\n    response += `âš¡ AÃ‡Ã•ES IMEDIATAS:\\n`;\n    response += immediateAction.map((action, i) => `${i+1}. ${action}`).join('\\n') + '\\n\\n';\n  }\n  \n  // EstratÃ©gia jurÃ­dica\n  if (legalStrategy.length > 0) {\n    response += `ğŸ¯ ESTRATÃ‰GIA JURÃDICA:\\n`;\n    response += legalStrategy.map((strategy, i) => `â€¢ ${strategy}`).join('\\n') + '\\n\\n';\n  }\n  \n  // Documentos necessÃ¡rios\n  if (documentsNeeded.length > 0) {\n    response += `ğŸ“‹ DOCUMENTOS NECESSÃRIOS:\\n`;\n    response += documentsNeeded.map((doc, i) => `${i+1}. ${doc}`).join('\\n') + '\\n\\n';\n  }\n  \n  // Investimento\n  response += `ğŸ’° INVESTIMENTO: ${estimatedCost}\\n\\n`;\n  \n  // Call to action\n  if (urgency >= 4) {\n    response += `ğŸ”´ URGENTE: Dr. JM precisa falar com vocÃª HOJE!\\n`;\n    response += `ğŸ“ Vou agendar contato IMEDIATO!`;\n  } else {\n    response += `ğŸ“ Vamos agendar sua consulta estratÃ©gica com Dr. JM?`;\n  }\n  \n  return response;\n}\n\nconst response = generateResponse(caseType, urgencyLevel, analysis);\n\n// ========================\n// ğŸ¯ RESULTADO FINAL\n// ========================\n\nconst result = {\n  user_number: userNumber,\n  case_type: 'criminal',\n  subtype: caseType,\n  urgency_level: urgencyLevel,\n  dr_jm_specialty: drJMSpecialty,\n  \n  // AnÃ¡lise detalhada\n  viability: analysis.viability,\n  success_chance: analysis.successChance,\n  estimated_cost: estimatedCost,\n  timeframe: timeframe,\n  \n  // AÃ§Ãµes e estratÃ©gias\n  immediate_actions: immediateAction,\n  legal_strategy: legalStrategy,\n  documents_needed: documentsNeeded,\n  \n  // Resposta e prÃ³ximos passos\n  response: response,\n  needs_immediate_contact: urgencyLevel >= 4,\n  needs_scheduling: urgencyLevel < 4,\n  priority_level: urgencyLevel >= 4 ? 'urgent' : 'high',\n  \n  // MÃ©tricas\n  processed_at: timestamp.toISOString(),\n  processing_time: 'instantaneous',\n  dr_jm_credentials: drJMCredentials,\n  \n  // PrÃ³ximas aÃ§Ãµes\n  next_steps: [\n    urgencyLevel >= 4 ? 'Contato imediato Dr. JM' : 'Agendar consulta',\n    'Reunir documentos necessÃ¡rios',\n    'Preparar estratÃ©gia de defesa',\n    'Iniciar procedimentos legais'\n  ]\n};\n\nconsole.log('âš–ï¸ SUPER CRIMINAL processado:', result);\n\nreturn result;"
      },
      "id": "super-criminal-processor",
      "name": "âš–ï¸ Super Processador Criminal",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [440, 400]
    },
    {
      "parameters": {
        "conditions": {
          "number": [
            {
              "value1": "={{ $json.urgency_level }}",
              "operation": "largerEqual",
              "value2": 4
            }
          ]
        }
      },
      "id": "check-urgent-criminal",
      "name": "ğŸš¨ Caso Urgente?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [640, 400]
    },
    {
      "parameters": {
        "to": "dr.jm@jmadvogados.com.br",
        "subject": "ğŸš¨ CASO CRIMINAL URGENTE - {{ $json.subtype.toUpperCase() }}",
        "message": "ALERTA URGÃŠNCIA MÃXIMA\\n\\nğŸ‘¤ Cliente: {{ $json.user_number }}\\nâš–ï¸ Tipo: {{ $json.subtype }}\\nğŸš¨ UrgÃªncia: {{ $json.urgency_level }}/5\\nâ° Prazo: {{ $json.timeframe }}\\n\\nğŸ“± MENSAGEM:\\n{{ $json.message }}\\n\\nğŸ¯ AÃ‡Ã•ES IMEDIATAS:\\n{{ $json.immediate_actions.join('\\nâ€¢ ') }}\\n\\nğŸ“ CONTATO NECESSÃRIO: HOJE!"
      },
      "id": "email-urgent-alert",
      "name": "ğŸ“§ Email Urgente Dr. JM",
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2,
      "position": [840, 300]
    },
    {
      "parameters": {
        "url": "https://api.whatsapp.com/send",
        "method": "POST",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "phone",
              "value": "+5544999999999"
            },
            {
              "name": "message",
              "value": "ğŸš¨ CASO URGENTE\\n\\nCliente: {{ $json.user_number }}\\nTipo: {{ $json.subtype }}\\nUrgÃªncia: {{ $json.urgency_level }}/5\\n\\nPrecisa contato IMEDIATO!"
            }
          ]
        }
      },
      "id": "whatsapp-alert-drjm",
      "name": "ğŸ“± WhatsApp Dr. JM",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [840, 200]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "INSERT INTO criminal_cases (user_number, case_type, subtype, urgency_level, viability, estimated_cost, immediate_actions, legal_strategy, documents_needed, created_at, dr_jm_specialty) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)",
        "parameters": {
          "parameters": [
            {
              "name": "user_number",
              "value": "={{ $json.user_number }}"
            },
            {
              "name": "case_type",
              "value": "criminal"
            },
            {
              "name": "subtype",
              "value": "={{ $json.subtype }}"
            },
            {
              "name": "urgency_level",
              "value": "={{ $json.urgency_level }}"
            },
            {
              "name": "viability",
              "value": "={{ $json.viability }}"
            },
            {
              "name": "estimated_cost",
              "value": "={{ $json.estimated_cost }}"
            },
            {
              "name": "immediate_actions",
              "value": "={{ JSON.stringify($json.immediate_actions) }}"
            },
            {
              "name": "legal_strategy",
              "value": "={{ JSON.stringify($json.legal_strategy) }}"
            },
            {
              "name": "documents_needed",
              "value": "={{ JSON.stringify($json.documents_needed) }}"
            },
            {
              "name": "created_at",
              "value": "={{ $json.processed_at }}"
            },
            {
              "name": "dr_jm_specialty",
              "value": "={{ $json.dr_jm_specialty }}"
            }
          ]
        }
      },
      "id": "save-criminal-case",
      "name": "ğŸ’¾ Salvar Caso Criminal",
      "type": "n8n-nodes-base.sqlite",
      "typeVersion": 1,
      "position": [1040, 400]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{ $json.needs_scheduling }}",
              "value2": true
            }
          ]
        }
      },
      "id": "check-needs-schedule",
      "name": "ğŸ“… Precisa Agendar?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [1240, 400]
    },
    {
      "parameters": {
        "url": "https://n8n-n8n.c9ewnj.easypanel.host/webhook/master_bot",
        "method": "POST",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "user_number",
              "value": "={{ $json.user_number }}"
            },
            {
              "name": "message",
              "value": "agendar consulta criminal"
            },
            {
              "name": "current_state",
              "value": "FREE"
            },
            {
              "name": "case_context",
              "value": "={{ $json.subtype }}"
            }
          ]
        }
      },
      "id": "trigger-scheduling",
      "name": "ğŸ“… Disparar Agendamento",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [1440, 300]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ { \"response\": $json.response, \"urgency\": $json.urgency_level, \"needs_immediate_contact\": $json.needs_immediate_contact, \"case_analysis\": { \"viability\": $json.viability, \"success_chance\": $json.success_chance, \"estimated_cost\": $json.estimated_cost }, \"next_steps\": $json.next_steps } }}"
      },
      "id": "final-criminal-response",
      "name": "âš–ï¸ Resposta Criminal Final",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [1640, 400]
    }
  ],
  "connections": {
    "âš–ï¸ Webhook Criminal AvanÃ§ado": {
      "main": [
        [
          {
            "node": "âš–ï¸ Super Processador Criminal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "âš–ï¸ Super Processador Criminal": {
      "main": [
        [
          {
            "node": "ğŸš¨ Caso Urgente?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸš¨ Caso Urgente?": {
      "main": [
        [
          {
            "node": "ğŸ“± WhatsApp Dr. JM",
            "type": "main",
            "index": 0
          },
          {
            "node": "ğŸ“§ Email Urgente Dr. JM",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ğŸ’¾ Salvar Caso Criminal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“§ Email Urgente Dr. JM": {
      "main": [
        [
          {
            "node": "ğŸ’¾ Salvar Caso Criminal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“± WhatsApp Dr. JM": {
      "main": [
        [
          {
            "node": "ğŸ’¾ Salvar Caso Criminal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ’¾ Salvar Caso Criminal": {
      "main": [
        [
          {
            "node": "ğŸ“… Precisa Agendar?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“… Precisa Agendar?": {
      "main": [
        [
          {
            "node": "ğŸ“… Disparar Agendamento",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "âš–ï¸ Resposta Criminal Final",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“… Disparar Agendamento": {
      "main": [
        [
          {
            "node": "âš–ï¸ Resposta Criminal Final",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {},
  "versionId": "1"
}
